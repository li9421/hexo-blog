# 详情页实现思路

---

<!-- more -->

## 一.点击商品进入详情页

+ GoodsListItem点击 

+ 点击之后获取商品的 `iid ` 跳转到详情页，并且传入`iid`

  

## 二. 解决 - 首页 保持位置状态

+  ```
  deactivated: 记录离开时的位置
  ```

+ ```
  activated: 通过scrollTo 函数 设置离开时位置 
  ```

+ bug： Better-Scroll 最新的1.15.0 有scrollT o 的位置

  + 解决方法 ： 进行版本的回退



## 三. 详情页的导航栏实现

+  返回按钮 ： `solt="left"`

+ 标题列表 ： `solt="center"` 

  

## 四. 请求详情的数据

+ 接口 /detail?iid



## 五. 轮播图的实现

+ Swiper/SwiperItem



## 六. 商品基本信息的展示

+ 数据来自四面八方
+ 对数据进行汇总：一个对象中
+ 一个对象传入子组件

## 七. 店铺信息展示



## 八. 商品图片的展示



## 九. 参数信息的展示



## 十. 评论信息的展示 

+ 时间格式化
+ 服务器返回的时间戳 转成 date -》格式
+ `yyyy-MM-dd hh:mm:ss`



## 十一. 推荐数据的展示

+ 请求推荐数据
+ `GoodsList` 展示数据



## 十二 , mixin 的使用

+ 创建一个混入对象 `const mixin = {}`
+ 组件对象中 ： `mixins: [mixin]`



### 十三.处理2个 bug

+ 首页tabControl
+ 详情滚动的bug


### 十四. 标题内容的联动效果
#### 14.1 点击标题滚动到对应的标题
+ 在detail中监听标题的点击，获取index
+ 滚动到对应的主题：
  + 获取所有主题的offsetTop
  + 问题：在哪里才能获取到正确的offsetTop
    1. created 肯定不行，压根不能获取数据
    2. mounted 也不行，数据还没有获取到
    3. 获取数据的回调也不行，DOM还没有渲染完
    4. $nextTick 也不行，因为图片的高度没有计算在内
    5. 在图片加载完成后，获取的高度才是正确的
    
#### 14.2 内容滚动，显示正确的标题

普通做法： 

```js
(this.curentIndex !==i)&&((i < length -1 && positionY >=this.themeTopYs[i] && positionY < this.themeTopYs[i=1]) || (i=== length -1 && positionY >= this.themeTopYs[i]))
条件成立： this.currentIndex = i
条件一： 防止赋值过于频繁
条件二：((i < length -1 && positionY >=this.themeTopYs[i] && positionY < this.themeTopYs[i=1]))
条件1. i < length -1 && positionY >=this.themeTopYs[i] 
判断区间： 在 0 和某个数字之间 （i<length - 1）
条件2： i=== length -1 && positionY >= this.themeTopYs[i]
判断大于等于： i=== length - 1
```

hack做法

```js
this.currentIndex !== i && (positionY >= this.themeTopYs[i] && positionY < this.themeTopYs[i+1])
// 在数组后面加多一个 决定不会到达的值，比如 js 的最大值，或者 最后一个的几倍数
// 这也就可以直接判断区间，不需要考虑最后一个
```

### 十五. 底部工具栏封装

+ detail-bottom-bar

### 十六. 详情页的回到顶部

+ home和detail 都有回到顶部 使用混入
+ mixin

### 十七. 点击加入购物车

#### 17.1  获取加入购物车的点击事件，并且获取商品的信息

+ 监听
+ 获取商品信息： iid/price/image/title...

#### 17.2 将商品添加到vuex中

+  安装vuex 
+ 配置vuex 
+ 定义mutation， 将商品添加到statr.cartlist
+ 重构代码
  + 将mutation 抽到 actions （定义两个 mutation）
  + 将 mutation/ actions 单独抽出到文件中

### 十八. 购物车的展示

#### 18.1 购物车的导航栏的展示

#### 18.2 购物车商品的展示

+ CartList -》 scroll（滚动问题）
+ CartListItem -》 CheckButton

#### 18.3 商品选中与不选中的切换

+ 修改数据模型，改变选中与不选择 
+ 逻辑是： 修改数据模型的数据 数据发生改变 影响到视图，视图发生改变

#### 18.4 底部工具栏的汇总

+ 全选按钮
+ 计算总价格
+ 去计算按钮

### 十九. 购物车的全选按钮的逻辑

+ 显示的状态
  + 判断是否有一个不选中，就是不选中
+ 点击全选按钮
  + 如果原来都是选中的，点击一次，全部不选择
  + 如果原来是不选中的或者有一个不选择，点击全部选中



### 二十. 添加购物车弹窗

#### 20.1 Vuex 的补充

+ Actions 可以返回一个Promise
+ mapActions 映射关系

#### 20.2 toast（吐司）封装

+ 普通封装
+ 插件封装

### 二十一. 补充一些细节

#### 21.1 `fastclick` 减小移动端点击的延迟

+ 安装 `fastclick`
+ 导入
+ 调用attach

#### 21.2 图片的懒加载

+ 什么图片懒加载
  + 图片需要显示到屏幕上再加载
+ 使用 vue-lazyload
+ 导入
+ Vue.use
+ 修改 `img :src ` 改成 `v-lazy`

#### 22.3 `px2vw` 插件使用

+ 安装插件
+ 在 `postcss.config.js`中进行配置

 

### 面试题

+ 如何理解Vue 的生命周期
+ 如何进行非父子组件通信
+ Vue的响应式原理(初级的前端开发)
  + 不要认为数据发生改变，界面跟着更新，并不是理所当然的
  + 









难点：

1.代码如何组织

2.业务逻辑(不要立即写代码 ，先组织逻辑)